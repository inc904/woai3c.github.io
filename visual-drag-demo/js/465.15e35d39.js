"use strict";(self["webpackChunkvisual_drag_demo"]=self["webpackChunkvisual_drag_demo"]||[]).push([[465],{6465:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var o=function(){var e=this,t=e._self._c;return"edit"==e.editMode?t("div",{staticClass:"v-text",on:{keydown:e.handleKeydown,keyup:e.handleKeyup}},[t("div",{ref:"text",class:{"can-edit":e.canEdit},style:{verticalAlign:e.element.style.verticalAlign},attrs:{contenteditable:e.canEdit,tabindex:e.element.id},domProps:{innerHTML:e._s(e.element.propValue)},on:{dblclick:e.setEdit,paste:e.clearStyle,mousedown:e.handleMousedown,blur:e.handleBlur,input:e.handleInput}})]):t("div",{staticClass:"v-text preview"},[t("div",{style:{verticalAlign:e.element.style.verticalAlign},domProps:{innerHTML:e._s(e.element.propValue)}})])},i=[],r=(n(6699),n(629)),s=n(9657),a=n(4471),c=n(2689),l={extends:c.Z,props:{propValue:{type:String,required:!0,default:""},request:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}},linkage:{type:Object,default:()=>{}}},data(){return{canEdit:!1,ctrlKey:17,isCtrlDown:!1,cancelRequest:null}},computed:{...(0,r.rn)(["editMode"])},created(){this.request&&(this.cancelRequest=(0,a.ZP)(this.request,this.element,"propValue","string"))},beforeDestroy(){this.request&&this.cancelRequest()},methods:{handleInput(e){this.$emit("input",this.element,e.target.innerHTML)},handleKeydown(e){this.canEdit&&e.stopPropagation(),e.keyCode==this.ctrlKey?this.isCtrlDown=!0:(this.isCtrlDown&&this.canEdit&&s.k.includes(e.keyCode)||46==e.keyCode)&&e.stopPropagation()},handleKeyup(e){this.canEdit&&e.stopPropagation(),e.keyCode==this.ctrlKey&&(this.isCtrlDown=!1)},handleMousedown(e){this.canEdit&&e.stopPropagation()},clearStyle(e){e.preventDefault();const t=e.clipboardData,n=t.getData("text/plain")||"";""!==n&&document.execCommand("insertText",!1,n),this.$emit("input",this.element,e.target.innerHTML)},handleBlur(e){this.element.propValue=e.target.innerHTML||"&nbsp;";const t=e.target.innerHTML;""!==t?this.element.propValue=e.target.innerHTML:(this.element.propValue="",this.$nextTick((()=>{this.element.propValue="&nbsp;"}))),this.canEdit=!1},setEdit(){this.element.isLock||(this.canEdit=!0,this.selectText(this.$refs.text))},selectText(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}}},u=l,d=n(1001),m=(0,d.Z)(u,o,i,!1,null,"13c5aec7",null),p=m.exports},2689:function(e,t,n){n.d(t,{Z:function(){return u}});var o,i,r=n(4003),s={props:{linkage:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}}},created(){this.linkage?.data?.length&&(r.Z.$on("v-click",this.onClick),r.Z.$on("v-hover",this.onHover))},mounted(){const{data:e,duration:t}=this.linkage||{};e?.length&&(this.$el.style.transition=`all ${t}s`)},beforeDestroy(){this.linkage?.data?.length&&(r.Z.$off("v-click",this.onClick),r.Z.$off("v-hover",this.onHover))},methods:{changeStyle(e=[]){e.forEach((e=>{e.style.forEach((e=>{e.key&&(this.element.style[e.key]=e.value)}))}))},onClick(e){const t=this.linkage.data.filter((t=>t.id===e&&"v-click"===t.event));this.changeStyle(t)},onHover(e){const t=this.linkage.data.filter((t=>t.id===e&&"v-hover"===t.event));this.changeStyle(t)}}},a=s,c=n(1001),l=(0,c.Z)(a,o,i,!1,null,null,null),u=l.exports},4471:function(e,t,n){n.d(t,{Ax:function(){return c},ZP:function(){return l},_q:function(){return i}});var o=n(4720);const i=/(https?):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/;function r(e){return new Promise(((t,n)=>{const o=new XMLHttpRequest;o.timeout=6e3;let i=c(e.url);"GET"===e.method&&(i+=`${s(e.data)}`),o.open(e.method,i),o.ontimeout=n,o.onerror=n,o.onload=e=>{t(e.target.response)},o.send(JSON.stringify(a(e.data,e.paramType)))}))}function s(e){let t="";return e.forEach((e=>{e[0]&&(t+=`&${e[0]}=${e[1]}`)})),t?"?"+t:""}function a(e,t){if(!e)return"";if("array"===t)return e;const n={};return e.forEach((e=>{e[0]&&(n[e[0]]=e[1])})),n}function c(e){return e.startsWith("http")?e:"https://"+e}function l(e,t,n,s="object"){let a,l=0;const u=e?.url;return(u&&!/^\d+$/.test(u)||i.test(c(u)))&&(e.series?a=setInterval((()=>{0!=e.requestCount&&e.requestCount<=l?clearInterval(a):(l++,r(e,s).then((e=>{t[n]="object"===s||"array"===s?JSON.parse(e):e})).catch((e=>o.Message.error(e?.message||e))))}),e.time):r(e,s).then((e=>{t[n]="object"===s||"array"===s?JSON.parse(e):e})).catch((e=>o.Message.error(e?.message||e)))),function(){clearInterval(a)}}},9657:function(e,t,n){n.d(t,{Y:function(){return S},k:function(){return C}});var o=n(6763),i=n(4003);const r=17,s=91,a=86,c=67,l=88,u=89,d=90,m=71,p=66,h=76,f=85,y=83,v=80,g=68,k=46,Z=69,C=[66,67,68,69,71,76,80,83,85,86,88,89,90],w={[a]:M,[u]:q,[d]:D,[y]:_,[v]:P,[Z]:A},b={...w,[f]:V},E={...w,[c]:x,[l]:T,[m]:L,[p]:H,[g]:j,[k]:j,[h]:O};let $=!1;function S(){window.onkeydown=e=>{if(!o.Z.state.isInEdiotr)return;const{curComponent:t}=o.Z.state,{keyCode:n}=e;n===r||n===s?$=!0:n==k&&t?(o.Z.commit("deleteComponent"),o.Z.commit("recordSnapshot")):$&&(!E[n]||t&&t.isLock?b[n]&&t&&t.isLock&&(e.preventDefault(),b[n]()):(e.preventDefault(),E[n]()))},window.onkeyup=e=>{e.keyCode!==r&&e.keyCode!==s||($=!1)},window.onmousedown=()=>{o.Z.commit("setInEditorStatus",!1)}}function x(){o.Z.commit("copy")}function M(){o.Z.commit("paste"),o.Z.commit("recordSnapshot")}function T(){o.Z.commit("cut")}function q(){o.Z.commit("redo")}function D(){o.Z.commit("undo")}function L(){o.Z.state.areaData.components.length&&(o.Z.commit("compose"),o.Z.commit("recordSnapshot"))}function H(){const e=o.Z.state.curComponent;e&&!e.isLock&&"Group"==e.component&&(o.Z.commit("decompose"),o.Z.commit("recordSnapshot"))}function _(){i.Z.$emit("save")}function P(){i.Z.$emit("preview")}function j(){o.Z.state.curComponent&&(o.Z.commit("deleteComponent"),o.Z.commit("recordSnapshot"))}function A(){i.Z.$emit("clearCanvas")}function O(){o.Z.commit("lock")}function V(){o.Z.commit("unlock")}}}]);
//# sourceMappingURL=465.15e35d39.js.map